<!DOCTYPE html>
<html lang="fr">
    <head>
        <title></title> 
        <meta charset="UTF-8">
        <meta name="description" content="MangaHana - Lecture de scans">
        <meta name="keywords" content="mangahana, scan, vf, sans pubs, free">
        <link rel="canonical" href="https://mangahana-scan.fr/">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="default">
        <meta name="mobile-web-app-capable" content="yes">
        <link rel="shortcut icon" type="image/png" href="img/mangahana-icon.png">
        <link rel="shortcut icon" sizes="192x192" href="img/mangahana-icon.png">
        <link rel="apple-touch-icon" href="img/mangahana-icon.png">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <link rel="stylesheet" href="styles/style.css">
        <link rel="stylesheet" href="styles/style-navbar.css">
        <link rel="stylesheet" href="styles/style-footer.css">
        <link rel="stylesheet" href="styles/style-history.css">
        <link rel="stylesheet" href="styles/style-manga-profile.css">
        <link rel="stylesheet" href="styles/resp-manga-profile.css">
    </head>

    <body>
        <!-- Navbar -->
        <nav>

            <!-- Burger button -->
            <div class="burger-menu">
                <button class="burger-menu-btn">
                    <div class="burger-line"></div>
                    <div class="burger-line"></div>
                    <div class="burger-line"></div>
                </button>
            </div>

            <!-- Logo -->
            <a class="nav-img" href=""><img src="img/mangahana-logo.png" alt="MangaHana-logo"></a>
            
            <!-- Barre de recherche -->
            <div class="nav-searchbar">
                <div class="flexbox">
                    <i class='bx bx-search'></i>
                    <input name="search_text" id="search_text" type="search" class="search-input" placeholder="Rechercher..." autocomplete="off">
                </div>
            </div>
            
            <!-- Logo icone-->
            <a class ="nav-img-2" href=""><img src="img/mangahana-icon.png" alt="MangaHana-logo"></a>

            <!-- Options navbar -->
            <div class="nav-categories">
                <a href="/" class="flex-container">
                    <div class="bx-container"><i class='bx bxs-home'></i></div>
                    <div class="a-container">Acc<span class="green-text">ueil</span></div>
                </a>
                <a href="/catalogue" class="flex-container">
                    <div class="bx-container"><i class='bx bxs-bookmarks'></i></div>
                    <div class="a-container">Cata<span class="green-text">logue</span></div>
                </a>
                <a href="" class="flex-container">    
                    <div class="bx-container"><i class='bx bx-shuffle'></i></div>
                    <div class="a-container">Se lan<span class="green-text">cer</span></div>
                </a>
                <a href="/profil" class="flex-container">
                    <div class="bx-container"><i class='bx bx-street-view'></i></div>
                    <div class="a-container">Pro<span class="green-text">fil</span></div>
                </a>
            </div>

            <div class="decoration-line">
                <div class="left-line"></div>
                <div class="right-line"></div>
            </div>
        </nav>

        <!-- Slide Menu -->
        <div class="slidemenu">

            <div class="logo-slidemenu">
                <button id="close-slidemenu"><i class='bx bxs-chevrons-left'></i></button>
                <img class="nav-img" src="img/mangahana-logo.png" alt="MangaHana-logo">
            </div>

            <div class="ligne-transition"></div>

            <!-- Options slide menu -->
            <div class="options-slidemenu">
                <div class="flexbox">
                <div class="flex-pour-centrer"></div>
                <a href="" class="flex-container">
                    <div class="bx-container"><i class='bx bxs-home'></i></div>
                    <div class="a-container">Acc<span class="green-text">ueil</span></div>
                    <div class="ligne-style"></div>
                </a>
                </div>
                <div class="flexbox">
                <div class="flex-pour-centrer"></div>
                <a href="" class="flex-container">
                    <div class="bx-container"><i class='bx bxs-bookmarks'></i></div>
                    <div class="a-container">Cata<span class="green-text">logue</span></div>
                    <div class="ligne-style"></div>
                </a>
                </div>
                <div class="flexbox">
                <div class="flex-pour-centrer"></div>
                <a href="" class="flex-container">    
                    <div class="bx-container"><i class='bx bx-shuffle'></i></div>
                    <div class="a-container">Se lan<span class="green-text">cer</span></div>
                    <div class="ligne-style"></div>
                </a>
                </div>
                <div class="flexbox">
                <div class="flex-pour-centrer"></div>
                <a href="" class="flex-container">
                    <div class="bx-container"><i class='bx bx-street-view'></i></div>
                    <div class="a-container">Pro<span class="green-text">fil</span></div>
                    <div class="ligne-style"></div>
                </a>
                </div>
            </div>

            <p>© 2024 MangaHana - Tous droits réservés.</p>
        </div>

        <button id="to-top-btn">
            <i class='bx bx-up-arrow-alt'></i>
        </button>

        <!-- Bloc entier -->
         <div class="bloc-entier">

            <div class="flexbox">
                <div class="left-flex">
                    <!-- Book informations -->
                    <div class="data-section">
                        <!-- Titre en responsive -->
                        <h1 id="titre" class="hidden-title"></h1>

                        <!-- Image, titre, synopsis et tags -->
                        <div class="data">

                            <!-- image et bouton favori -->
                            <div class="left-flex">
                                <div class="img-container"><img src="" alt=""></div>
                                <button id="addtoFav">AJOUTER AUX FAVORIS</button>
                            </div>

                            <!-- Autres informations -->
                            <div class="much-info">
                                <h1 id="titre2"></h1>
                                <div class="synopsis">
                                    <p id="synopsis"></p>
                                </div>

                                <div class="tags" id="tags-container"></div>

                                <div class="separation-info"></div>
                                <div class="caracteristics">
                                    <div class="auteur-sortie">
                                        <div class="carac-box">
                                            <p><span class="bolder bigger">Auteur(e)</span></p>
                                            <p class="italic" id="auteur"></p>
                                        </div>
                                        <div class="carac-box">
                                            <p><span class="bolder bigger">Sortie</span></p>
                                            <p class="italic" id="sortie"></p>
                                        </div>
                                    </div>
                                    <div class="dessinateur-statut">
                                        <div class="carac-box">
                                            <p><span class="bolder bigger">Dessins</span></p>
                                            <p class="italic" id="dessinateur"></p>
                                        </div>
                                        <div class="carac-box">
                                            <p><span class="bolder bigger">Statut</span></p>
                                            <p class="italic" id="statut"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sélection des chapitres -->
                    <div class="chapter-section">
                        <!-- chapitre et titre du manga -->
                        <div class="chapter-title">
                            <h1>Chapitres</h1>
                            <div class="sep-line"></div>
                        </div>

                        <!-- Zone de scroll pour les chapitres -->
                        <div class="scroll-flexbox"></div>

                        <!-- Si les chapitres ne sont pas encore disponible -->
                        <div class="explication">
                            <p><span id="indispo-name" class="bolder"></span> n'est pas encore disponible. <br><br>
                                Nous essayons constamment d'améliorer nos capacités de stockage afin de vous proposer le plus d'oeuvres possible. <br><br>
                                S'il est accessible, c'est que nous avons pour objectif de le compter officiellement dans notre catalogue au plus vite. <br><br>
                                
                                Nous vous invitons à patienter, <span class="green">merci pour votre confiance.</span>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="right-flex">
                    <!-- Recommendations aléatoires -->
                    <div class="reco-section">
                        <div class="titre-bloc"><h1>Recommendations</h1></div>
                        <div class="random-manga">
                            <a href="youtube.com" target="_blank">
                                <div class="img-container">
                                    <img src="img/couvertures/tome-20TH-CENTURYBOYS.jpg" alt="tome-20TH-CENTURYBOYS">
                                </div>
                                <div class="infos">
                                    <h1>20Th Century Boys</h1>
                                    <div class="tag-box">
                                        <p><span class="recommendation-tag">Tags</span> : Horreur, Mystère</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="random-manga">
                            <a href="youtube.com" target="_blank">
                                <div class="img-container">
                                    <img src="img/couvertures/tome-BALLROOM.jpg" alt="tome-BALLROOM">
                                </div>
                                <div class="infos">
                                    <h1>Kaoru Hana wa Rin to Saku</h1>
                                    <div class="tag-box">
                                        <p>Tags : <span class="recommendation-tag">Sports, Romance, Comédie</span></p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="random-manga">
                            <a href="youtube.com" target="_blank">
                                <div class="img-container">
                                    <img src="img/couvertures/tome-BLUE-BOX.jpg" alt="tome-BLUE-BOX">
                                </div>
                                <div class="infos">
                                    <h1>Blue Box</h1>
                                    <div class="tag-box">
                                        <p>Tags : <span class="recommendation-tag">Sports, Romance</span></p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="random-manga">
                            <a href="youtube.com" target="_blank">
                                <div class="img-container">
                                    <img src="img/couvertures/tome-FIRE-PUNCH.jpg" alt="tome-FIRE-PUNCH">
                                </div>
                                <div class="infos">
                                    <h1>Fire Punch</h1>
                                    <div class="tag-box">
                                        <p>Tags : <span class="recommendation-tag">Action, Supernaturel</span></p>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="random-manga">
                            <a href="youtube.com" target="_blank">
                                <div class="img-container">
                                    <img src="img/couvertures/tome-CSM.jpg" alt="tome-CSM">
                                </div>
                                <div class="infos">
                                    <h1>Chainsaw Man</h1>
                                    <div class="tag-box">
                                        <p>Tags : <span class="recommendation-tag">Action, Supernaturel</span></p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Historique de lecture -->
                    <div class="history">
                        <p>Vos dernières lectures</p>
                    </div>
                </div>
            </div>
        </div>

        <script src="script/script-slidemenu.js"></script>
        <script src="script/script-to-top-btn.js"></script>
        <script src="script/script-cookies.js"></script>

        <!-- Historique de lecture -->
        <script>
            async function fetchMangaData() {
                try {
                    const response = await fetch('/api/manga-data');
                    const data = await response.json();
                    return data; 
                } catch (error) {
                    console.error("Erreur lors de la récupération des données de l'API:", error);
                    return {};
                }
            }
            
            async function updateHistoryList() {
                const history = getCookie('lastReadChapters');
                if (!history) return; 
            
                const historyListDiv = document.querySelector('.history');
                if (!historyListDiv) return; 

                const chapters = history.split(',');
                const mangaData = await fetchMangaData();
                chapters.reverse();
                chapters.forEach((chapter) => {
                    const [mangaSlug, chapterNumber] = chapter.split('/');
            
                    const mangaInfo = mangaData[mangaSlug];
                    if (mangaInfo) {
                        const mangaTitle = mangaInfo.Nom;
                        const newLink = document.createElement('a');
                        newLink.classList.add('history-line');
                        newLink.href = `/${mangaSlug}/${chapterNumber}`;
                        newLink.innerHTML = `${mangaTitle} : Chapitre ${chapterNumber}`;
                        historyListDiv.appendChild(newLink);
                    }
                });
            }
        </script>

        <!-- Affichage des informations et chapitrage -->
        <script>
            const mangaName = window.location.pathname.split('/')[1]; 
        
            fetch('/api/manga-data')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erreur lors du chargement des données');
                }
                return response.json();
            })
            .then(data => {
                const mangaData = data[mangaName];
                if (!mangaData) {
                    throw new Error('Manga non trouvé');
                }
        
                document.getElementById('titre').innerText = mangaData.Nom;
                document.getElementById('titre2').innerText = mangaData.Nom;
                document.getElementById('synopsis').innerText = mangaData.Synopsis;
                document.getElementById('auteur').innerText = mangaData.Auteur;
                document.getElementById('dessinateur').innerText = mangaData.Dessinateur;
                document.getElementById('sortie').innerText = mangaData.Sortie;
                document.getElementById('statut').innerText = mangaData.Statut;
                document.getElementById('indispo-name').innerText = mangaData.Nom;
        
                const tagsContainer = document.getElementById('tags-container');
                const tags = mangaData.Tags.split(', ');
                tags.forEach(tag => {
                    const tagDiv = document.createElement('div');
                    tagDiv.classList.add('tag');
                    tagDiv.innerHTML = `<div id="tag"><p>${tag}</p></div>`;
                    tagsContainer.appendChild(tagDiv);
                });
        
                const imageElement = document.querySelector('.img-container img');
                imageElement.src = mangaData.Image; 
                imageElement.alt = mangaData.Nom; 
        
                const MangaName = mangaData.Nom;
                document.title = `${MangaName} | MangaHana`;
        
                // Initialiser le bouton des favoris en fonction du cookie
                initFavoriteButton(mangaName);

                updateHistoryList();
            });
        
            // Ajouter ou retirer le manga des favoris
            function toggleFavorite(mangaName) {
                let favoriteMangas = getCookie('favManga');
                favoriteMangas = favoriteMangas ? favoriteMangas.split(',') : [];
        
                const index = favoriteMangas.indexOf(mangaName);
        
                if (index === -1) {
                    // Ajouter aux favoris
                    favoriteMangas.push(mangaName);
                    setCookie('favManga', favoriteMangas.join(','), 7);
                    setButtonActive(true);
                } else {
                    // Retirer des favoris
                    favoriteMangas.splice(index, 1);
                    setCookie('favManga', favoriteMangas.join(','), 7);
                    setButtonActive(false);
                }
            }
        
            // Fonction pour définir l'état du bouton (actif ou non)
            function setButtonActive(isActive) {
                const addToFavoritesBtn = document.getElementById('addtoFav');
                if (isActive) {
                    addToFavoritesBtn.classList.add('favPut');
                    addToFavoritesBtn.textContent = 'RETIRER DES FAVORIS';
                } else {
                    addToFavoritesBtn.classList.remove('favPut');
                    addToFavoritesBtn.textContent = 'AJOUTER AUX FAVORIS';
                }
            }
        
            // Fonction pour initialiser l'état du bouton en fonction des favoris
            function initFavoriteButton(mangaName) {
                let favoriteMangas = getCookie('favManga');
                favoriteMangas = favoriteMangas ? favoriteMangas.split(',') : [];
        
                const isFavorite = favoriteMangas.includes(mangaName);
                setButtonActive(isFavorite);
        
                // Ajouter un événement au bouton "Ajouter aux favoris"
                const addToFavoritesBtn = document.getElementById('addtoFav');
                addToFavoritesBtn.addEventListener('click', function() {
                    toggleFavorite(mangaName);
                });
            }
        
            // Charger les chapitres lors du chargement de la page
            window.onload = async function() {
                const mangaName = window.location.pathname.split('/')[1]; // Récupérer le nom du manga depuis l'URL
                await loadChaptersInScrollBox(mangaName); // Charger les chapitres dans la flexbox
            };
        
            // Fonction pour charger et afficher les chapitres dans la scroll-flexbox
            async function loadChaptersInScrollBox(manga) {
                try {
                    const response = await fetch(`/api/${manga}/chapters`);
                    const chapters = await response.json();
        
                    const scrollContainer = document.querySelector('.scroll-flexbox');
                    const explication = document.querySelector('.explication');
                    scrollContainer.innerHTML = ''; // Vider la flexbox avant d'ajouter des chapitres
        
                    if (chapters.length > 0) {
                        // Si des chapitres existent, cacher le message d'explication
                        explication.style.display = 'none';
        
                        chapters.forEach(chapter => {
                            const link = document.createElement('a');
                            const chapterLabel = formatChapterLabel(chapter);
        
                            link.href = `/${manga}/${chapter}`;
                            link.textContent = chapterLabel;
                            link.addEventListener('click', () => handleChapterChange(manga, chapter));
        
                            scrollContainer.appendChild(link);
                        });
                    } else {
                        explication.style.display = 'flex';
                    }
                } catch (error) {
                    console.error('Erreur lors du chargement des chapitres :', error);
                }
            }
        
            // Fonction pour formater les labels des chapitres
            function formatChapterLabel(chapter) {
                if (chapter.toLowerCase().includes('volume')) {
                    return chapter;
                } else {
                    return `Chapitre ${chapter}`;
                }
            }
        </script>

        <footer>
            <div class="decoration-line">
                <div class="left-line"></div>
                <div class="right-line"></div>
            </div>

            <div class="flexbox">
                <div class="flex-container">
                    <a href="./index.html">Accueil</a>
                    <div class="footer-line"></div>
                    <a href="./a-propos.html">À propos de nous</a>
                    <div class="footer-line"></div>
                    <a href="#">Privacy Policy</a>
                    <div class="footer-line"></div>
                    <a href="./dmca.html">DMCA</a>
                </div>
                <p>©MangaHana - Tous droits réservés.</p>
            </div>

        </footer>
    </body>
</html>